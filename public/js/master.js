import {act} from "./action.js";
import {startBattle, continueToBattle, startNextTurn} from "./battle.js";
import {adjustOptions} from "./list.js";
import {Settings} from "./settings.js";
import {addCardInit} from "./cardPicker.js";

const actionsList = document.getElementById("actionList");
const actionElementsList = document.getElementById("actionElementsList");
const addPlayerCardButton = document.getElementById("addPlayerCardButton");
const addEnemyCardButton = document.getElementById("addEnemyCardButton");
const actButton = document.getElementById("actButton");
const startBattleButton = document.getElementById("startBattleButton");
const continueToBattleButton = document.getElementById("continueToBattleButton");
const nextTurnButton = document.getElementById("nextTurnButton");

actionsList.addEventListener("change", () =>  { adjustOptions("actionElements") }, false);
actionElementsList.addEventListener("change", () => { adjustOptions("targets") }, false);
addPlayerCardButton.addEventListener("click", () => { addCardInit("player") }, false);
addEnemyCardButton.addEventListener("click", () => { addCardInit("enemy") }, false);
actButton.addEventListener("click", () => { act() }, false);
startBattleButton.addEventListener("click", () => { startBattle() }, false);
continueToBattleButton.addEventListener("click", () => { continueToBattle() }, false);
nextTurnButton.addEventListener("click", () => { startNextTurn() }, false);

/**
 * A Participant
 * @typedef {Object} Participant
 * @property {string} _id - Participant's unique id generated by MongoDB
 * @property {string} name - Participant's name
 * @property {number} maxHealth - Participant's endurance
 * @property {number} health - Participant's current hp (for use in battles)
 * @property {number} speed - Participant's speed
 * @property {number} attack - Participant's attack
 * @property {number} dodge - Participant's dodge
 * @property {boolean} isDodging - Participant dodge action on or off
 * @property {string} type - Participant type (enemy/player)
 * @property {string} [subtype] - Enemy type (human/monster)
 * @property {number} [experience] - Participant's xp count, only for players
 * @property {Object} [itemsOwned] - Participant's items, only for players and human enemies
 * @property {Object} skillsOwned - Participant's skills/spells
 * @property {number} [level] - Participant's level, only for players
 * @property {number} armor - Participant's armor rating
 * @property {number} [zone] - Participant's zone, only for enemies
 * @property {array} statusesApplied - Array of statuses applied on the participant
 */
await Settings.fetchEnemies();

/**
 * An Item
 * @typedef {Object} Item
 * @property {string} uiid - Unique item id
 * @property {string} displayName - Item display name
 * @property {string} type - Item type (healing/statModifier)
 * @property {string} subtype - item subtype (for healing items - restore/revive. for statMods - self/reverse to specify the target)
 * @property {string} valueType - Item value type (flat or percentage)
 * @property {number} value - Item value (flat number or decimal percentage)
 * @property {array} statusesApplied - Status objects applied or Internal names of the statuses applied (to be found) by the item
 */
await Settings.fetchItems();

await Settings.fetchSpells();
await Settings.fetchSkills();

await Settings.fetchStatuses();